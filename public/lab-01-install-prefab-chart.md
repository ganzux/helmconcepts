# Lab 01: Install a Prefab Helm Chart

## A. Prerequisites

### Install Docker
Docker has a convenient installation script if you're on a *nix-based system. If you're on Windows, [Docker Desktop](https://docs.docker.com/desktop/install/windows-install/) is recommended.
1. In a terminal, download the Docker install script.

```
curl -fsSL https://get.docker.com -o get-docker.sh
```

2. Run the Docker install script.  

```
sh get-docker.sh
```

3. Set permissions so you can run Docker without sudo.

```
sudo groupadd docker
sudo usermod -aG docker $USER
```

4. For the permissions to take effect, logout and back in and/or open a new user shell.

5. Test the Docker installation.

```
docker run hello-world
```

### Install K3D

6. Run the K3D installer script.

```
curl -s https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh | bash
```

7. Create a cluster.

```
k3d cluster create mycluster
```

8. Follow [these instructions](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/) to install kubeclt on your OS and architecture.

9. Verify kubectl can communicate with your k3d cluster.

```
kubectl get nodes
```

10. Run the Helm installer script.

```
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
```
```
helm -v
```

## Deploy with Helm

1. Add a new helm repository
   
```
helm repo add bitnami https://charts.bitnami.com/bitnami
```

2. Update Helm.

```
helm repo update
```

3. Install PostgreSQL via helm chart.

```
helm install mypostgresql bitnami/postgresql
```

4. Save the PostgreSQL service's autogenerated password.

```
export POSTGRES_PASSWORD=$(kubectl get secret --namespace default mypostgresql -o jsonpath="{.data.postgres-password}" | base64 -d)
```

5. Connect to the database.

```
kubectl run mypostgresql-client --rm --tty -i --restart='Never' --namespace default --image docker.io/bitnami/postgresql:16.2.0-debian-12-r8 --env="PGPASSWORD=$POSTGRES_PASSWORD" --command -- psql --host mypostgresql -U postgres -d postgres -p 5432
```

6. Verify your connection to the database from the postgres command prompt.

```
\conninfo
```

7. Quit out of postgres.

```
\q
```

8. Uninstall the helm chart.

```
helm uninstall mypostgresql
```

9. For the PostGres helm chart, deletion doesn't quite delete all Kubernetes resources. Check if there is any dangling storage.

```
kubectl get pvc
```

10. Delete the leftover persistent volume claim.

```
kubectl delete pvc data-mypostgresql-0
```














